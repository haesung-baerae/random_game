<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Mind Reader</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: radial-gradient(circle at top right, #f8fafc, #e2e8f0); min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="importmap">
    {
      "imports": {
        "@google/generative-ai": "https://esm.sh/@google/generative-ai@^0.21.0"
      }
    }
    </script>

    <script type="text/babel">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        const { useState, useEffect, useCallback, useRef } = React;
        const MAX_GUESSES = 10;
        const RANGE_MAX = 100;
        const GameStatus = { IDLE: 'IDLE', PLAYING: 'PLAYING', WON: 'WON', LOST: 'LOST' };

        // Ï§ëÏöî: Vercel ÌôòÍ≤Ω Î≥ÄÏàòÏóêÏÑú ÌÇ§Î•º ÏùΩÏñ¥Ïò§Í±∞ÎÇò, ÌÖåÏä§Ìä∏Ïö©ÏúºÎ°ú ÏßÅÏ†ë ÏûÖÎ†• Í∞ÄÎä•
        const API_KEY = "YOUR_API_KEY_HERE"; 

        const App = () => {
            const [targetNumber, setTargetNumber] = useState(0);
            const [currentGuess, setCurrentGuess] = useState('');
            const [history, setHistory] = useState([]);
            const [status, setStatus] = useState(GameStatus.IDLE);
            const [aiFeedback, setAiFeedback] = useState({ message: "1~100 ÏÇ¨Ïù¥ Ïà´ÏûêÎ•º ÏÉùÍ∞ÅÌñàÏñ¥Ïöî. ÎßûÏ∂∞Î≥¥ÏÑ∏Ïöî!", emoji: "üîÆ" });
            const [isLoading, setIsLoading] = useState(false);
            const inputRef = useRef(null);

            const startNewGame = useCallback(() => {
                setTargetNumber(Math.floor(Math.random() * RANGE_MAX) + 1);
                setHistory([]);
                setCurrentGuess('');
                setStatus(GameStatus.PLAYING);
                setAiFeedback({ message: "Ïûê, Ïù¥Î≤àÏóî Ïñ¥Îñ§ Ïà´ÏûêÏù∏ÏßÄ ÎßûÏ∂∞Î≥¥Ïã§ÍπåÏöî?", emoji: "üîÆ" });
                setTimeout(() => inputRef.current?.focus(), 100);
            }, []);

            useEffect(() => { startNewGame(); }, [startNewGame]);

            const getAIFeedback = async (guess, target, history, hint) => {
                try {
                    const genAI = new GoogleGenerativeAI(API_KEY);
                    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                    
                    const prompt = `User guessed ${guess}. Target is ${target}. Hint: ${hint}. History: [${history.join(', ')}]. Provide a very short, witty comment in Korean as a Game Master. JSON format: {"message": "...", "emoji": "..."}`;
                    
                    const result = await model.generateContent(prompt);
                    const responseText = result.response.text();
                    // JSON Î∂ÄÎ∂ÑÎßå Ï∂îÏ∂ú (ÎßàÌÅ¨Îã§Ïö¥ Î∞©ÏßÄ)
                    const jsonStr = responseText.substring(responseText.indexOf('{'), responseText.lastIndexOf('}') + 1);
                    return JSON.parse(jsonStr);
                } catch (error) {
                    console.error("AI Error:", error);
                    return { message: hint === 'UP' ? "Îçî ÎÜíÍ≤å!" : "Îçî ÎÇÆÍ≤å!", emoji: "üí°" };
                }
            };

            const handleGuess = async (e) => {
                e?.preventDefault();
                const guess = parseInt(currentGuess);
                if (isNaN(guess) || status !== GameStatus.PLAYING) return;

                setIsLoading(true);
                let hint = guess < targetNumber ? 'UP' : guess > targetNumber ? 'DOWN' : 'CORRECT';
                
                const newRecord = { value: guess, hint, timestamp: Date.now() };
                const updatedHistory = [newRecord, ...history];
                setHistory(updatedHistory);
                setCurrentGuess('');

                if (hint === 'CORRECT') setStatus(GameStatus.WON);
                else if (updatedHistory.length >= MAX_GUESSES) setStatus(GameStatus.LOST);

                const feedback = await getAIFeedback(guess, targetNumber, updatedHistory.map(h => h.value), hint);
                setAiFeedback(feedback);
                setIsLoading(false);
                inputRef.current?.focus();
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    <div className="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-100">
                        <div className="bg-indigo-600 p-6 text-white text-center">
                            <h1 className="text-2xl font-bold">Gemini Mind Reader</h1>
                            <div className="absolute top-4 right-4 bg-indigo-500 rounded-full px-3 py-1 text-xs">
                                {history.length}/{MAX_GUESSES}
                            </div>
                        </div>
                        
                        <div className="p-6 bg-slate-50 flex items-center space-x-4">
                            <div className="text-3xl p-3 bg-white rounded-2xl border">{aiFeedback.emoji}</div>
                            <div className="bg-white p-3 rounded-2xl shadow-sm text-sm flex-1">
                                {isLoading ? "AIÍ∞Ä ÏÉùÍ∞Å Ï§ë..." : aiFeedback.message}
                            </div>
                        </div>

                        <div className="p-8 space-y-6">
                            {status === GameStatus.PLAYING ? (
                                <form onSubmit={handleGuess} className="space-y-4">
                                    <input ref={inputRef} type="number" value={currentGuess} onChange={(e) => setCurrentGuess(e.target.value)}
                                        className="w-full text-4xl font-bold text-center py-4 rounded-2xl border-2 focus:border-indigo-500 outline-none" placeholder="1-100" />
                                    <button type="submit" disabled={isLoading} className="w-full bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition-transform">
                                        ÌôïÏù∏ÌïòÍ∏∞
                                    </button>
                                </form>
                            ) : (
                                <div className="text-center space-y-4">
                                    <div className="text-6xl">{status === GameStatus.WON ? 'üèÜ' : 'üíÄ'}</div>
                                    <h2 className="text-3xl font-bold">{status === GameStatus.WON ? 'ÏäπÎ¶¨!' : 'Ìå®Î∞∞'}</h2>
                                    <p>Ï†ïÎãµ: <span className="text-indigo-600 font-bold">{targetNumber}</span></p>
                                    <button onClick={startNewGame} className="w-full bg-slate-800 text-white font-bold py-4 rounded-2xl">Îã§Ïãú ÌïòÍ∏∞</button>
                                </div>
                            )}
                            
                            <div className="grid grid-cols-5 gap-2">
                                {history.slice().reverse().map(h => (
                                    <div key={h.timestamp} className="text-center p-2 rounded-xl border bg-white text-xs font-bold">
                                        {h.value} <span>{h.hint === 'UP' ? '‚ñ≤' : h.hint === 'DOWN' ? '‚ñº' : '‚òÖ'}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
