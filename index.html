<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Mind Reader</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background: radial-gradient(circle at top right, #f8fafc, #e2e8f0); min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.sh/@google/generative-ai@0.21.0";
        window.GoogleGenerativeAI = GoogleGenerativeAI;
    </script>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;
        const MAX_GUESSES = 10;
        const RANGE_MAX = 100;
        const GameStatus = { IDLE: 'IDLE', PLAYING: 'PLAYING', WON: 'WON', LOST: 'LOST' };

        // API í‚¤ ì„¤ì •
        const API_KEY = "AIzaSyCSZrCfLjFSRvTWF6CnO-PjSRFhdI2bIOc"; 

        const App = () => {
            const [targetNumber, setTargetNumber] = useState(0);
            const [currentGuess, setCurrentGuess] = useState('');
            const [history, setHistory] = useState([]);
            const [status, setStatus] = useState(GameStatus.IDLE);
            const [aiFeedback, setAiFeedback] = useState({ message: "1~100 ì‚¬ì´ ìˆ«ìžë¥¼ ìƒê°í–ˆì–´ìš”. ë§žì¶°ë³´ì„¸ìš”!", emoji: "ðŸ”®" });
            const [isLoading, setIsLoading] = useState(false);
            const inputRef = useRef(null);

            const startNewGame = useCallback(() => {
                setTargetNumber(Math.floor(Math.random() * RANGE_MAX) + 1);
                setHistory([]);
                setCurrentGuess('');
                setStatus(GameStatus.PLAYING);
                setAiFeedback({ message: "ìž, ì´ë²ˆì—” ì–´ë–¤ ìˆ«ìžì¸ì§€ ë§žì¶°ë³´ì‹¤ê¹Œìš”?", emoji: "ðŸ”®" });
                setTimeout(() => inputRef.current?.focus(), 100);
            }, []);

            useEffect(() => { startNewGame(); }, [startNewGame]);

            const getAIFeedback = async (guess, target, history, hint) => {
                try {
                    // ì „ì—­ ë³€ìˆ˜ window.GoogleGenerativeAIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                    const genAI = new window.GoogleGenerativeAI(API_KEY);
                    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                    
                    const prompt = `ë‹¹ì‹ ì€ ì•„ì£¼ ë¬´ë¡€í•˜ì§€ë§Œ ìœ ë¨¸ëŸ¬ìŠ¤í•œ ìˆ«ìž ë§žì¶”ê¸° ê²Œìž„ ë§ˆìŠ¤í„°ìž…ë‹ˆë‹¤. ì‚¬ìš©ìžê°€ ìž…ë ¥í•œ ìˆ«ìž: ${guess}. ì •ë‹µ: ${target}. ížŒíŠ¸: ${hint}. ì´ì „ ê¸°ë¡: [${history.join(', ')}]. ìœ„ ìƒí™©ì— ë§žì¶°ì„œ ì‚¬ìš©ìžì—ê²Œ ì•„ì£¼ ì§§ê³ , í‚¹ë°›ê²Œ í•œêµ­ì–´ë¡œ ë§í•˜ì„¸ìš”. ì´ëª¨í‹°ì½˜ë„ í•˜ë‚˜ ê¼­ í¬í•¨í•˜ì„¸ìš”. JSON í˜•ì‹ìœ¼ë¡œë§Œ ëŒ€ë‹µí•˜ì„¸ìš”: {"message": "ëŒ€ì‚¬", "emoji": "ì´ëª¨í‹°ì½˜"}`;
                    
                    const result = await model.generateContent(prompt);
                    const responseText = result.response.text();
                    const jsonStr = responseText.substring(responseText.indexOf('{'), responseText.lastIndexOf('}') + 1);
                    return JSON.parse(jsonStr);
                } catch (error) {
                    console.error("AI Error:", error);
                    return { message: hint === 'UP' ? "ë” ë†’ê²Œ!" : "ë” ë‚®ê²Œ!", emoji: "ðŸ’¡" };
                }
            };

            const handleGuess = async (e) => {
                e?.preventDefault();
                const guess = parseInt(currentGuess);
                if (isNaN(guess) || status !== GameStatus.PLAYING) return;

                setIsLoading(true);
                let hint = guess < targetNumber ? 'UP' : guess > targetNumber ? 'DOWN' : 'CORRECT';
                
                const newRecord = { value: guess, hint, timestamp: Date.now() };
                const updatedHistory = [newRecord, ...history];
                setHistory(updatedHistory);
                setCurrentGuess('');

                if (hint === 'CORRECT') setStatus(GameStatus.WON);
                else if (updatedHistory.length >= MAX_GUESSES) setStatus(GameStatus.LOST);

                const feedback = await getAIFeedback(guess, targetNumber, updatedHistory.map(h => h.value), hint);
                setAiFeedback(feedback);
                setIsLoading(false);
                inputRef.current?.focus();
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    <div className="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-100">
                        <div className="bg-indigo-600 p-6 text-white text-center">
                            <h1 className="text-2xl font-bold">Gemini Mind Reader</h1>
                            <div className="absolute top-4 right-4 bg-indigo-500 rounded-full px-3 py-1 text-xs">
                                {history.length}/{MAX_GUESSES}
                            </div>
                        </div>
                        
                        <div className="p-6 bg-slate-50 flex items-center space-x-4">
                            <div className="text-3xl p-3 bg-white rounded-2xl border">{aiFeedback.emoji}</div>
                            <div className="bg-white p-3 rounded-2xl shadow-sm text-sm flex-1">
                                {isLoading ? (
                                    <div className="flex space-x-1">
                                        <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce"></div>
                                        <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.15s]"></div>
                                        <div className="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-bounce [animation-delay:-0.3s]"></div>
                                    </div>
                                ) : aiFeedback.message}
                            </div>
                        </div>

                        <div className="p-8 space-y-6">
                            {status === GameStatus.PLAYING ? (
                                <form onSubmit={handleGuess} className="space-y-4">
                                    <input ref={inputRef} type="number" value={currentGuess} onChange={(e) => setCurrentGuess(e.target.value)}
                                        className="w-full text-4xl font-bold text-center py-4 rounded-2xl border-2 focus:border-indigo-500 outline-none" placeholder="1-100" />
                                    <button type="submit" disabled={isLoading} className="w-full bg-indigo-60
